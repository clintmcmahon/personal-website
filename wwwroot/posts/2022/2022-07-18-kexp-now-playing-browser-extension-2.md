---
title: "KEXP now playing browser extension"
description: ""
date: "2022-07-18"
draft: false
slug: "kexp-now-playing-browser-extension-2"
tags:
---

<!--kg-card-begin: html--><p><!--kg-card-begin: html--></p>
<p><a href="https://kexp.org" data-type="URL" data-id="https://kexp.org" target="_blank" rel="noreferrer noopener">KEXP</a> is a radio station in Seattle that I&#8217;ve listened to regularly almost every day for the past twenty years. Since I live in Minneapolis I use their streaming service to listen via their app, my Sonos or a desktop player. During the work day I  via my desktop VLC player where the track information is not available. I actually have a <a href="https://clintmcmahon.com/centralized-streaming-radio-stations/" data-type="URL" data-id="https://clintmcmahon.com/centralized-streaming-radio-stations/" target="_blank" rel="noreferrer noopener">pretty great .pls file that contains all the best streaming radio stations</a> from around the world &#8211; but that&#8217;s not what I&#8217;m writing about today. Streaming the station outside the app doesn&#8217;t provide any playlist information or what song is currently being played. So, if I hear a song I like or one that I don&#8217;t know the title to I have to open a new browser tab or entirely new window, browse to <a href="https://kexp.org" data-type="URL" data-id="https://kexp.org" target="_blank" rel="noreferrer noopener">kexp.org</a> and see what the currently playing track is from their  home page widget. This lead me to create a KEXP now playing browser extension for Firefox and Chrome.</p>
<p>The browser extension is very simple and does one thing: when the user clicks the extension in their browser it hits <a href="https://api.kexp.org" target="_blank" data-type="URL" data-id="https://api.kexp.org" rel="noreferrer noopener">KEXP&#8217;s public API playing endpoint</a>, returns the now playing track, artist and album information, then displays that information right there in a neat browser fly out. </p>
<h2>Code</h2>
<p>The browser extension is built in React and JavaScript. There are two main parts to the code, getting the data inside the useEffect React Hook inside the main App component and a component called &lt;NowPlaying /> (along with child components) that do the presentation of the now playing data.</p>
<p>Below you can see there are two fetch requests to the KEXP API. The first request is to the <strong>/plays</strong> endpoint to return the full list of recently played tracks. There is not a way to get just the currently playing track, so I grab the first item from the array which turns out to be the most recent item. Then I parse the object to get all the necessary information include the <strong>show_uri</strong>. The second request is to the <strong>show_uri</strong> endpoint to return what show is currently playing.</p>
<p>After the two requests the NowPlaying.js component breaks down the returned object to render in the extension window. The rendered information is the show title and host in the header along with album artwork along with the artist, track album and KEXP comment that was included with the track displayed in the body. </p>
<h3>App.js</h3>
<div style="height: 250px; position:relative; margin-bottom: 50px;" class="wp-block-simple-code-block-ace">
<pre class="wp-block-simple-code-block-ace" style="position:absolute;top:0;right:0;bottom:0;left:0" data-mode="javascript" data-theme="monokai" data-fontsize="14" data-lines="Infinity" data-showlines="true" data-copy="false">function App() {  const [nowPlaying, setNowPlaying] = useState(null);  useEffect(() => {    fetch("https://api.kexp.org/v2/plays/")      .then((response) => response.json())      .then(data => {        if (data.results &amp;&amp; data.results.length > 0) {          let results = data.results;          let trackData = results[0];          let nowPlaying = {            thumbnailUri: trackData.thumbnail_uri,            album: trackData.album,            artist: trackData.artist,            song: trackData.song,            playType: trackData.play_type,            comment: trackData.comment,            showTitle: "",            showDJs:[]          };          let showUri = trackData.show_uri;          fetch(showUri)            .then(response => response.json())            .then((showData => {              nowPlaying.showTitle = showData.program_name;              nowPlaying.showDJs = showData.host_names;              setNowPlaying(nowPlaying);            }));        };      })  }, []);  return (    &lt;div className="wrapper">      &lt;NowPlaying nowPlaying={nowPlaying} />    &lt;/div>  );}</pre>
</div>
<h3>NowPlaying.js</h3>
<p>Parent component to parse apart the nowPlaying parameter. Consists of header, thumbnail and track information.</p>
<div style="height: 250px; position:relative; margin-bottom: 50px;" class="wp-block-simple-code-block-ace">
<pre class="wp-block-simple-code-block-ace" style="position:absolute;top:0;right:0;bottom:0;left:0" data-mode="javascript" data-theme="monokai" data-fontsize="14" data-lines="Infinity" data-showlines="true" data-copy="false">function NowPlaying(props) {    let nowPlaying = props.nowPlaying;        return (            &lt;>                &lt;div className="header">                    &lt;Header showTitle={nowPlaying.showTitle} showDJs={nowPlaying.showDJs} />                &lt;/div>                &lt;div className="content">                    &lt;div className="left">                        &lt;Thumbnail                            thumbnailUri={nowPlaying.thumbnailUri}                            album={nowPlaying.album}                        />                    &lt;/div>                    &lt;div className="right">                        &lt;TrackInfo                            artist={nowPlaying.artist}                            song={nowPlaying.song}                            album={nowPlaying.album}                            playType={nowPlaying.playType}                        />                    &lt;/div>                &lt;/div>                &lt;div className="comment">                    &lt;Comment                        comment={nowPlaying.comment}                    />                &lt;/div>            &lt;/>        )}export default NowPlaying;</pre>
</div>
<h3>Header.js</h3>
<p>Display the header title bar that includes the show name and host. Part of this title includes a link to the <a href="https://kexp.org/donate" target="_blank" data-type="URL" data-id="https://kexp.org/donate" rel="noreferrer noopener">KEXP donation page</a>. </p>
<div style="height: 250px; position:relative; margin-bottom: 50px;" class="wp-block-simple-code-block-ace">
<pre class="wp-block-simple-code-block-ace" style="position:absolute;top:0;right:0;bottom:0;left:0" data-mode="javascript" data-theme="monokai" data-fontsize="14" data-lines="Infinity" data-showlines="true" data-copy="false">function Header(props) {    let djText = "";    console.log(props.showDJs)    if (props.showDJs) {        djText = props.showDJs.map((item, i) => {            let name = item;            if (i !== 0) {                name = "/" + name;            }            return name;        });    }    return (        &lt;div className="title">            &lt;a href="https://www.kexp.org/donate/" alt="Support the music">{props.showTitle ? props.showTitle : ""} {djText ? `with ${djText}` : ""}&lt;/a>        &lt;/div>    )}export default Header;</pre>
</div>
<h3>Thumbnail.js</h3>
<p>This component displays the thumbnail image if there is one present in the parent response. If there isn&#8217;t one available I&#8217;m displaying a placeholder image.</p>
<div style="height: 250px; position:relative; margin-bottom: 50px;" class="wp-block-simple-code-block-ace">
<pre class="wp-block-simple-code-block-ace" style="position:absolute;top:0;right:0;bottom:0;left:0" data-mode="javascript" data-theme="monokai" data-fontsize="14" data-lines="Infinity" data-showlines="true" data-copy="false">import placeHolder from "../images/placeholder.png";function Thumbnail(props) {      if (props.thumbnailUri) {      return &lt;img src={props.thumbnailUri} alt={props.album} />    }    return &lt;img src={placeHolder} alt="Now playing placeholder" />}export default Thumbnail;</pre>
</div>
<h3>TrackInfo.js</h3>
<p>HTML breakdown of the track information. Checking if the track is actually an airbreak, otherwise display the track information.</p>
<div style="height: 250px; position:relative; margin-bottom: 50px;" class="wp-block-simple-code-block-ace">
<pre class="wp-block-simple-code-block-ace" style="position:absolute;top:0;right:0;bottom:0;left:0" data-mode="javascript" data-theme="monokai" data-fontsize="14" data-lines="Infinity" data-showlines="true" data-copy="false">function TrackInfo(props) {        if (props.playType === "airbreak") {        return (            &lt;div className="block">                Air Break            &lt;/div>        )    }    return (        &lt;>            &lt;div className="block">                &lt;div className="label">                    Song:            &lt;/div>                &lt;div className="text">                    {props.song}                &lt;/div>            &lt;/div>            &lt;div className="block">                &lt;div className="label">                    Artist:                &lt;/div>                &lt;div className="text">                    {props.artist}                &lt;/div>            &lt;/div>            &lt;div className="block">                &lt;div className="label">                    Album:                &lt;/div>                &lt;div className="text">                    {props.album}                &lt;/div>            &lt;/div>        &lt;/>    )}export default TrackInfo;</pre>
</div>
<h2>Download</h2>
<p>The browser extension is available for both Firefox and Chrome as well as source code available in Github. Download and install from the links below.</p>
<p><a href="https://addons.mozilla.org/en-US/firefox/addon/kexp-now-playing" data-type="URL" data-id="https://addons.mozilla.org/en-US/firefox/addon/kexp-now-playing" target="_blank" rel="noreferrer noopener">Firefox</a> | <a href="https://chrome.google.com/webstore/detail/kexp-now-playing/kkfjnljpfpmkjbgnmoejneflokjfcncb?" data-type="URL" data-id="https://chrome.google.com/webstore/detail/kexp-now-playing/kkfjnljpfpmkjbgnmoejneflokjfcncb?" target="_blank" rel="noreferrer noopener">Chrome</a> | <a href="https://github.com/clintmcmahon/kexp-now-playing-extension" target="_blank" data-type="URL" data-id="https://github.com/clintmcmahon/kexp-now-playing-extension" rel="noreferrer noopener">Github</a></p>
</p>
<p><!--kg-card-end: html--></p>
<!--kg-card-end: html-->
