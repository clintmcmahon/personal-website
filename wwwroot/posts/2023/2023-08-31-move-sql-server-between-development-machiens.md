---
title: "Moving Docker SQL Server databases between machines"
description: "In this blog post I'll show how I migrated my SQL Server databases between machines and Docker containers."
date: "2023-08-31"
draft: false
slug: "move-sql-server-between-development-machiens"
tags:
---

<p>I'm in the middle of migrating all my apps and databases to a new Macbook Air machine. Since I do all my .Net Core development on MacOS I use Docker containers to manage any SQL Server databases that I'm working with. In this blog post I'll show how I migrated my SQL Server databases between machines and Docker containers.</p><h2 id="create-a-database-backup-on-machine-1">Create a database backup on machine 1 </h2><p>I used Azure Data Studio to manage SQL Server databases from my Mac. Azure Data studio is a fine substitute for SQL Server Management Studio, but it lakes the majority of the features. Though I'll take the lack of features for the ability to development on my macOS machine any day. </p><p>To back up a database from Azure Data Studio, connect to your server, navigate to the database and right click the database. Then select the Backup option from the drop down menu. Select the options you need and click <strong>Backup</strong>. Take not of the <strong>Backup files </strong>location as you're going to need this to copy the file from the Docker container to your local machine. Here my backup copy will be made in <code>/var/opt/mssql/data</code> folder within the current Docker container.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="/images/2023/08/Screenshot-2023-08-18-at-11.11.25-AM.png" class="kg-image" alt loading="lazy" srcset="/images/2023/08/Screenshot-2023-08-18-at-11.11.25-AM.png 600w, /images/2023/08/Screenshot-2023-08-18-at-11.11.25-AM.png 724w" sizes="(min-width: 720px) 720px" sizes="(max-width: 720px) 100vw, 720px" class="kg-image" loading="lazy" style="width: 100%; height: auto; max-width: 100%;"><figcaption>Use Azure Data Studio to backup a database</figcaption></figure><h2 id="copy-the-database-backup-to-a-central-location">Copy the database backup to a central location</h2><p>Now using the Docker command <code>docker cp</code> copy the the database backup file from the Docker container to your local machine and then to a central location where you can access the backup file from the destination machine. </p><ol><li>Open the Docker dashboard on the source machine, locate the SQL Server container, then copy the container id. </li></ol><figure class="kg-card kg-image-card kg-card-hascaption"><img src="/images/2023/08/Screenshot-2023-08-18-at-11.18.40-AM.png" class="kg-image" alt loading="lazy" srcset="/images/2023/08/Screenshot-2023-08-18-at-11.18.40-AM.png 600w, /images/2023/08/Screenshot-2023-08-18-at-11.18.40-AM.png 956w" sizes="(min-width: 720px) 720px" sizes="(max-width: 720px) 100vw, 720px" class="kg-image" loading="lazy" style="width: 100%; height: auto; max-width: 100%;"><figcaption>Locate SQL Server container</figcaption></figure><figure class="kg-card kg-image-card kg-card-hascaption"><img src="/images/2023/08/Screenshot-2023-08-18-at-11.18.55-AM.png" class="kg-image" alt loading="lazy" srcset="/images/2023/08/Screenshot-2023-08-18-at-11.18.55-AM.png 600w, /images/2023/08/Screenshot-2023-08-18-at-11.18.55-AM.png 966w" sizes="(min-width: 720px) 720px" sizes="(max-width: 720px) 100vw, 720px" class="kg-image" loading="lazy" style="width: 100%; height: auto; max-width: 100%;"><figcaption>Copy the container id</figcaption></figure><p>2.  Open Terminal and execute the <code>docker cp</code> command with the following parameters: {yourContainerId}:{containerBackupFileLocation} {destinationFolder}<br></p><pre><code class="language-bash">docker cp cbd5323d5caf78c9b7434ff46eccbba0b5c20e2e4807d71fd83a6394372fc1c0:/var/opt/mssql/data/Machine-1-2023818-11-11-11.bak ~/code</code></pre><p>3.  This will copy the .bak file from the previous step into a folder called <code>code</code> on your local machine. Make sure the destination folder <code>code</code> exists before you run this command.</p><p>4. Transfer the .bak to a central location that the new machine can access. Something like Dropbox or shared filed location is good. And then download the file to the new machine. </p><p>5. Run the following command from the new machine to create the backup folder within the new Docker Container. <code>sql</code> is the name of the new SQL Server container running on the new machine.</p><pre><code class="language-bash">sudo docker exec -it sql mkdir /var/opt/mssql/backup</code></pre><p>6. Run the following command on the new machine to copy the database from your new machine into the new SQL Server container. Replacing `Machine 1-2023818-11-11-11.bak` with the name of your backup file.</p><pre><code class="language-bash">sudo docker cp Machine-1-2023818-11-11-11.bak sql:/var/opt/mssql/backup</code></pre><p>7. Open Azure Data Studio, right click on your database name and select <code>restore</code>. The current version of Azure Data Studio requires the database to exist before you can do a restore. If the database does not already exist, create a blank database to restore to. Navigate to the location inside the container that was created in the previous step.</p><figure class="kg-card kg-image-card"><img src="/images/2023/08/Screenshot-2023-08-31-at-9.51.21-AM.png" class="kg-image" alt loading="lazy" srcset="/images/2023/08/Screenshot-2023-08-31-at-9.51.21-AM.png 600w, /images/2023/08/Screenshot-2023-08-31-at-9.51.21-AM.png 1000w, /images/2023/08/Screenshot-2023-08-31-at-9.51.21-AM.png 1010w" sizes="(min-width: 720px) 720px" sizes="(max-width: 720px) 100vw, 720px" class="kg-image" loading="lazy" style="width: 100%; height: auto; max-width: 100%;"></figure><p>That should do it. You are now able to use the old database. I actually ran into an issue during this process where the containers I was using for my new M1 machine were too far ahead of the existing database that I was trying to transfer over. So keep in mind that depending on the container you are using, certain versions of SQL Server might not be compatible between Docker instances.</p>
